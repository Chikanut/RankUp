<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuizForge - –ö–∞—Ç–∞–ª–æ–≥ —Ç–µ—Å—Ç—ñ–≤</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="app">
    
    <!-- Header -->
    <header class="main-header">
      <div class="header-content">
        <div class="header-left">
          <h1>üéØ QuizForge</h1>
          <p class="tagline">–ú–æ–¥—É–ª—å–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è</p>
        </div>
        <div class="header-right">
          <button class="btn-ghost" id="statsBtn">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
          <button class="btn-ghost" id="settingsBtn">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
        </div>
      </div>
    </header>

    <div id="navBar" style="display:none;margin-bottom:16px;">
      <button class="btn-ghost" id="backBtn">‚Üê –ù–∞–∑–∞–¥</button>
      <span id="breadcrumb" style="margin-left:12px;color:#9ca3af;"></span>
    </div>
    
    <!-- Filters -->
    <div class="filters-section" style="display:none;">
      <div class="search-box">
        <input 
          type="text" 
          id="searchInput" 
          placeholder="üîç –ü–æ—à—É–∫ —Ç–µ—Å—Ç—ñ–≤..." 
          class="search-input"
        />
      </div>
      
      <div class="filters-row">
        <div class="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</label>
          <select id="categoryFilter" class="filter-select">
            <option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:</label>
          <select id="difficultyFilter" class="filter-select">
            <option value="">–í—Å—ñ —Ä—ñ–≤–Ω—ñ</option>
            <option value="easy">–õ–µ–≥–∫–æ</option>
            <option value="medium">–°–µ—Ä–µ–¥–Ω—å–æ</option>
            <option value="hard">–°–∫–ª–∞–¥–Ω–æ</option>
          </select>
        </div>
        
        <button class="btn-ghost" id="clearFilters">–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</button>
      </div>
    </div>
    
    <!-- Tests Grid -->
    <div id="testsGrid" class="tests-grid">
      <!-- –ö–∞—Ä—Ç–∫–∏ —Ç–µ—Å—Ç—ñ–≤ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è JS -->
    </div>
    
    <!-- Footer -->
    <footer class="main-footer">
      <div class="footer-content">
        <div class="footer-left">
          <p>QuizForge v0.4.5</p>
          <p class="muted">–†–æ–∑—Ä–æ–±–Ω–∏–∫: –°–Ü–ì–°–ü–ü –í–ü–§ –î–®–í 199 –ù–¶ –º–æ–ª–æ–¥—à–∏–π —Å–µ—Ä–∂–∞–Ω—Ç –í–æ–π—Ç–æ–≤–∏—á –Ñ–≤–≥–µ–Ω</p>
        </div>
        <div class="footer-right">
          <p class="muted">–ü—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω ‚Ä¢ –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</p>
        </div>
      </div>
    </footer>
    
  </div>
  
  <!-- Loading screen -->
  <div id="loading" class="loading-screen">
    <div class="loading-spinner"></div>
    <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–∞–ª–æ–≥—É...</p>
  </div>
  
  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ -->
  <script type="module">
   let config = null;
let currentFolder = null; // null = –∫–æ—Ä—ñ–Ω—å
let navigationStack = []; // —ñ—Å—Ç–æ—Ä—ñ—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó

async function loadConfig() {
  const response = await fetch('data/tests.json');
  config = await response.json();
  return config;
}

function renderContent() {
  const grid = document.getElementById('testsGrid');
  const items = getCurrentItems();
  
  if (items.length === 0) {
    grid.innerHTML = '<div class="empty-state"><p>–ü—É—Å—Ç–æ</p></div>';
    return;
  }
  
  grid.innerHTML = items.map(item => {
    if (item.type === 'folder') {
      return `
        <div class="test-card" onclick="openFolder('${item.id}')">
          <div class="test-icon">üìÅ</div>
          <h3 class="test-title">${item.name}</h3>
          <p class="test-description">${item.description}</p>
          <button class="btn-primary btn-block">–í—ñ–¥–∫—Ä–∏—Ç–∏ ‚Üí</button>
        </div>
      `;
    } else {
      return `
        <div class="test-card">
          <div class="test-icon">${item.icon}</div>
          <h3 class="test-title">${item.title}</h3>
          <p class="test-description">${item.description}</p>
          <div class="test-meta">
            <span class="badge">${item.totalQuestions} –ø–∏—Ç–∞–Ω—å</span>
            <span class="badge">${item.estimatedTime}</span>
            <span class="badge badge-${item.difficulty}">${getDifficultyText(item.difficulty)}</span>
          </div>
          <button class="btn-primary btn-block" onclick="startTest('${item.id}')">–ü–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç ‚Üí</button>
        </div>
      `;
    }
  }).join('');
  
  updateNavigation();
}

function getDifficultyText(difficulty) {
  const map = {'easy': '–õ–µ–≥–∫–æ', 'medium': '–°–µ—Ä–µ–¥–Ω—å–æ', 'hard': '–°–∫–ª–∞–¥–Ω–æ'};
  return map[difficulty] || difficulty;
}

function getCurrentItems() {
  if (!currentFolder) {
    // –ö–æ—Ä—ñ–Ω—å - –ø–æ–∫–∞–∑—É—î–º–æ –ø–∞–ø–∫–∏ –≤–µ—Ä—Ö–Ω—å–æ–≥–æ —Ä—ñ–≤–Ω—è —ñ —Ç–µ—Å—Ç–∏ –±–µ–∑ –ø–∞–ø–∫–∏
    const folders = (config.folders || []).map(f => ({...f, type: 'folder'}));
    const testsInFolders = getAllTestIdsInFolders();
    const rootTests = config.tests.filter(t => !testsInFolders.has(t.id));
    return [...folders, ...rootTests];
  }
  
  // –í—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–ø–∫–∏
  const folder = findFolderById(currentFolder);
  if (!folder) return [];
  
  const items = [];
  if (folder.children) {
    items.push(...folder.children.map(f => ({...f, type: 'folder'})));
  }
  if (folder.tests) {
    items.push(...config.tests.filter(t => folder.tests.includes(t.id)));
  }
  return items;
}

function findFolderById(id, folders = config.folders) {
  for (let f of folders) {
    if (f.id === id) return f;
    if (f.children) {
      const found = findFolderById(id, f.children);
      if (found) return found;
    }
  }
  return null;
}

function getAllTestIdsInFolders(folders = config.folders) {
  const ids = new Set();
  const traverse = (items) => {
    for (let item of items) {
      if (item.tests) item.tests.forEach(id => ids.add(id));
      if (item.children) traverse(item.children);
    }
  };
  traverse(folders);
  return ids;
}

window.openFolder = function(folderId) {
  navigationStack.push(currentFolder);
  currentFolder = folderId;
  renderContent();
};

window.goBack = function() {
  if (navigationStack.length > 0) {
    currentFolder = navigationStack.pop();
    renderContent();
  }
};

function updateNavigation() {
  const navBar = document.getElementById('navBar');
  const breadcrumb = document.getElementById('breadcrumb');
  
  if (currentFolder) {
    navBar.style.display = 'block';
    const folder = findFolderById(currentFolder);
    breadcrumb.textContent = folder ? folder.name : '';
  } else {
    navBar.style.display = 'none';
  }
}

window.startTest = function(testId) {
  window.location.href = `quiz.html?test=${testId}`;
};

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
window.addEventListener('DOMContentLoaded', async () => {
  await loadConfig();
  renderContent();
  document.getElementById('backBtn').addEventListener('click', goBack);
  document.getElementById('loading').style.display = 'none';
    // –î–æ–¥–∞–π —Ü—ñ —Ä—è–¥–∫–∏:
  document.getElementById('statsBtn').addEventListener('click', () => {
    window.location.href = 'stats.html';
  });
  
  document.getElementById('settingsBtn').addEventListener('click', () => {
    window.location.href = 'settings.html';
  });
});
  </script>
</body>
</html>
